<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.prod.ProdMapper">

    <resultMap id="prod" type="com.example.demo.prod.ProdDTO" />
    <resultMap id="cate" type="com.example.demo.prod.CateDTO"/>
    <resultMap id="brand" type="com.example.demo.prod.BrandDTO"/>
    <resultMap id="color" type="com.example.demo.prod.ColorDTO"/>

    <insert id="prodInsertProc" parameterType="com.example.demo.prod.ProdDTO">
        INSERT INTO product (prodNo, brandCode, cateCode, prodName, incomePrice, sellPrice, size, colorCode, quan, prodCon, regDate)
        VALUES (#{prodNo}, #{brandCode}, CONCAT(#{cateGroup},'(',#{cateCode},')'), #{prodName}, #{incomePrice}, #{sellPrice}, #{size}, #{colorCode}, #{quan}, #{prodCon}, CURRENT_TIMESTAMP)
    </insert>
    
    <!--셀렉트 옵션-->
    <select id="cateGroupList" resultMap="cate">
        SELECT DISTINCT cateGroup FROM category;
    </select>
    <select id="cateCodeList" resultMap="cate">
        SELECT DISTINCT cateCode FROM category;
    </select>
    <select id="brandCodeList" resultMap="brand">
        SELECT * FROM brand;
    </select>
    <select id="colorCodeList" resultMap="color">
        SELECT * FROM color;
    </select>
<!-- 
    <select id = "prodList">
        SELECT * FROM product WHERE prodNo LIKE CONCAT('%', #{prodNo}, '%')
    </select> -->

    <select id="searchProd" resultType="com.example.demo.prod.ProdDTO">
    SELECT * FROM product
    <where>
        <if test="cateCode == null or cateCode == ''">
            OR cateCode like concat (#{cateGroup}, '%')
        </if>
        <if test="cateGroup == null or cateGroup == ''">
            OR  cateCode like concat ('%', #{cateCode}, '%')
        </if>
        <if test="cateCode != null or cateCode != '' and cateGroup != null or cateGroup != ''">
            OR  cateCode = CONCAT(#{cateGroup},'(',#{cateCode},')')
        </if>
        <if test="colorCode != null and colorCode != ''">
            OR colorCode = #{colorCode}
        </if>
        <if test="size != null and size != ''">
            OR size = #{size}
        </if>
    </where>
</select>

<!-- 
    <select id = "searchProd" resultType="com.example.demo.prod.ProdDTO">
        SELECT * FROM product
            <where>
                cateCode like concat
                <if test="cateGroup != null and prodNo != ''">
                    AND prodNo LIKE CONCAT('%', #{prodNo}, '%')
                </if> -->
                <!--<if test="cateCode != null and cateCode != ''">
                    AND cateCode = #{cateCode}
                </if>
                <if test="colorCode != null and colorCode != ''">
                    AND colorCode = #{colorCode}
                </if>
                <if test="size != null and size != ''">
                    AND size = #{size}
                </if>
        </where>
    </select> -->

    <!-- 카테고리 추가 -->
    <insert id="addBrand" parameterType="com.example.demo.prod.BrandDTO">
        INSERT INTO brand (brandCode, brandDescription) 
        VALUES (#{brandCode}, #{brandDescription})
    </insert>

    <insert id="addCategory" parameterType="com.example.demo.prod.CateDTO">
        INSERT INTO category (cateGroup, cateCode, cateName) 
        VALUES (#{cateGroup}, #{cateCode}, #{cateName})
    </insert>
    
    <insert id="addColor" parameterType="com.example.demo.prod.ColorDTO">
        INSERT INTO color (colorCode, colorName) VALUES (#{colorCode}, #{colorName})
    </insert>


</mapper>


